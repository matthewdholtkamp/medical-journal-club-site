<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Medical Literature Summarizer</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
<style>
.font-roboto-condensed { font-family: 'Roboto Condensed', sans-serif; }
.font-inter { font-family: 'Inter', sans-serif; }
</style>
</head>
<body class="bg-gray-900 text-zinc-200 font-inter min-h-screen">
<div class="max-w-3xl mx-auto p-4">
<h1 class="text-orange-400 text-3xl font-roboto-condensed mb-4">Medical Literature Summarizer</h1>
<label for="topic" class="block mb-2 font-roboto-condensed">Enter your medical question or topic:</label>
<input type="text" id="topic" class="w-full text-gray-900 p-2 rounded-md mb-4">
<button id="submit" class="px-4 py-2 rounded-md font-bold bg-orange-600 text-white hover:bg-orange-700 mb-4">Submit</button>
<div id="questionArea" class="my-4 p-4 bg-gray-800 rounded-lg border border-gray-700 hidden"></div>
<div id="summaryArea" class="my-4 p-4 bg-gray-800 rounded-lg border border-gray-700 hidden"></div>
<div id="buttonsArea" class="mt-4 space-x-2 hidden">
<button id="audioDownload" class="px-4 py-2 rounded-md font-bold bg-blue-600 text-white hover:bg-blue-700">Download Lecture Audio</button>
<button id="keyDownload" class="px-4 py-2 rounded-md font-bold bg-blue-600 text-white hover:bg-blue-700">Download Key Points</button>
</div>
</div>
<script>
async function askFollowUps(topic) {
  const response = await fetch('/.netlify/functions/chatgpt-proxy', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ prompt: topic, operation: 'followups' })
  });
  const data = await response.json();
  return data.result.trim();
}

async function getSummary(prompt) {
  const response = await fetch('/.netlify/functions/chatgpt-proxy', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ prompt: prompt, operation: 'summary' })
  });
  const data = await response.json();
  return data.result.trim();
}

async function getKeyPoints(prompt) {
  const response = await fetch('/.netlify/functions/chatgpt-proxy', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ prompt: prompt, operation: 'keypoints' })
  });
  const data = await response.json();
  return data.result.trim();
}

async function generateAudio(text) {
  const utterance = new SpeechSynthesisUtterance('Hello, I am Dr. Matthew Holtkamp. ' + text);
  speechSynthesis.speak(utterance);
}

document.getElementById('submit').onclick = async () => {
  const topic = document.getElementById('topic').value.trim();
  if (!topic) return;
  const questionArea = document.getElementById('questionArea');
  const summaryArea = document.getElementById('summaryArea');
  const buttonsArea = document.getElementById('buttonsArea');

  questionArea.classList.remove('hidden');
  summaryArea.classList.remove('hidden');

  questionArea.innerHTML = '<h2 class="text-xl font-roboto-condensed text-orange-400 mb-2">Follow-up questions</h2><p>Loading...</p>';
  const followups = await askFollowUps(topic);
  questionArea.innerHTML = '<h2 class="text-xl font-roboto-condensed text-orange-400 mb-2">Follow-up questions</h2><pre>' + followups + '</pre>';

  summaryArea.innerHTML = '<h2 class="text-xl font-roboto-condensed text-orange-400 mb-2">Journal Club Summary</h2><p>Generating summary...</p>';
  const summary = await getSummary(topic);
  summaryArea.innerHTML = '<h2 class="text-xl font-roboto-condensed text-orange-400 mb-2">Journal Club Summary</h2><pre>' + summary + '</pre>';

  const keyPoints = await getKeyPoints(topic);
  buttonsArea.classList.remove('hidden');

  document.getElementById('audioDownload').onclick = () => {
    generateAudio(summary);
  };
  document.getElementById('keyDownload').onclick = () => {
    const blob = new Blob([keyPoints], { type:'text/plain' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'key_points.txt';
    link.click();
  };
};
</script>
</body>
</html>
